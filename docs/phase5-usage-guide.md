# Math Formula Plugin - 使用指南（测试版本）

**版本**: 1.0.0-beta  
**更新日期**: 2026-02-26

---

## 目录

1. [LaTeX 输入和实时预览](#latex-输入和实时预览)
2. [UnicodeMath 粘贴和转换](#unicodemath-粘贴和转换)
3. [自定义字体包使用](#自定义字体包使用)
4. [SVG 插入到 Illustrator](#svg-插入到-illustrator)

---

## LaTeX 输入和实时预览

### 基本操作

1. 在输入框中输入 LaTeX 公式
2. 预览区会实时显示渲染结果
3. 如果有语法错误，会显示错误提示

### 支持的 LaTeX 语法

**基础语法**：
- **分数**：`\frac{a}{b}`
- **上下标**：`x^2`, `x_i`, `x_i^2`
- **根号**：`\sqrt{x}`, `\sqrt[3]{x}`
- **括号伸缩**：`\left( \frac{a}{b} \right)`

**高级语法**：
- **求和**：`\sum_{i=1}^{n} x_i`
- **积分**：`\int_{0}^{\infty} f(x) dx`
- **矩阵**：`\begin{matrix} a & b \\ c & d \end{matrix}`
- **希腊字母**：`\alpha`, `\beta`, `\gamma`
- **函数名**：`\sin(x)`, `\log(y)`

### 示例公式

```latex
f(x) = \frac{\sum_{i=1}^{n} x_i^2}{\sqrt{n}}
```

---

## UnicodeMath 粘贴和转换

### 从 PowerPoint 粘贴公式

1. **在 PowerPoint 中**：
   - 选择公式
   - 右键选择"线性格式"（或"专业格式"→"线性格式"）
   - 复制（Ctrl/Cmd + C）

2. **在插件中**：
   - 在输入框中粘贴（Ctrl/Cmd + V）
   - 插件会自动识别 UnicodeMath 格式
   - 转换为 LaTeX 并显示预览

### 支持的 UnicodeMath 语法

- **分数**：`a/b`
- **上下标**：`x^2`, `x_i`
- **根号**：`√x`, `∛x`
- **求和**：`∑_(i=1)^n x_i`
- **积分**：`∫_0^∞ f(x) dx`

### 歧义处理

如果输入存在歧义（如 `x^2^3`），插件会：
- 显示多种解析结果
- 提供预览对比
- 允许您选择正确的解释

### 格式切换

在格式选择器中，您可以手动切换输入格式：
- **LaTeX**：直接输入 LaTeX 代码
- **UnicodeMath**：粘贴 PowerPoint 公式
- **AsciiMath**：简化的数学表达式（降级兜底）

---

## 自定义字体包使用

### 概述

插件支持使用自定义字体替换公式中的字母数字（A-Z, a-z, 0-9），同时保持数学符号的默认样式。

### 如何打开字体包工具

1. 在插件面板中，找到字体选择器
2. 点击字体选择器旁边的"⋮"（三点）按钮
3. 在下拉菜单中选择"打开字体包构建工具"
4. 浏览器会自动打开字体包工具的 Web 界面

### 使用字体包工具

1. **上传字体文件**：
   - 点击"选择字体文件"按钮
   - 选择您的 TTF 或 OTF 字体文件

2. **填写字体包名称**：
   - 输入一个有意义的名称（如 "My Custom Font"）

3. **选择字符集选项**（可选）：
   - 默认字符集：A-Z, a-z, 0-9（始终启用）
   - 可选字符集：括号、符号等（可选启用）

4. **开始转换**：
   - 点击"开始转换"按钮
   - 等待转换完成（通常几秒钟）

5. **查看结果**：
   - 转换成功后，会显示字体包信息
   - 包括字体名称、更新时间、文件列表等

### 如何刷新字体信息

字体包工具生成新字体包后，插件会在 2 秒内自动检测并重新加载。

如果需要手动刷新：
1. 点击字体选择器旁边的"⋮"（三点）按钮
2. 在下拉菜单中选择"刷新字体信息"
3. 插件会立即重新加载字体包

### 使用自定义字体

1. 在字体选择器中选择"自主字体"
2. 预览区会显示使用自定义字体的公式
3. 插入到 Illustrator 后，字母数字将使用自定义字体

### 恢复默认字体

在字体选择器中选择"默认字体"，公式将使用 MathJax 默认字体。

### 字体替换范围

**会被替换的字符**：
- 字母数字：A-Z, a-z, 0-9
- 基础运算符：+ - = × · ÷ < > ≤ ≥ −
- 基础定界符：| /
- 基础标点：. , : ; ' ! %

**不会被替换的符号**：
- 希腊字母（α, β, γ 等）
- 伸缩定界符（由 MathJax 动态生成）
- 根号结构、分数线
- 大型运算符（∑, ∏, ∫ 等）

---

## SVG 插入到 Illustrator

### 插入步骤

1. **确保已打开文档**：
   - 在使用插入功能前，必须先创建或打开 Illustrator 文档

2. **输入公式**：
   - 在输入框中输入 LaTeX 公式
   - 或粘贴 PowerPoint 公式

3. **预览确认**：
   - 在预览区确认公式显示正确

4. **插入到 Illustrator**：
   - 点击"插入到 Illustrator"按钮
   - 公式将作为矢量图形插入到文档中

### 插入属性

- **对象类型**：Group/PathItems（矢量）
- **插入位置**：当前视图中心（或画板中心）
- **插入尺寸**：宽度约 200pt（等比缩放）
- **字号统一**：所有公式的 em 大小（x-height）保持一致

### 插入后的编辑

- 插入的公式是矢量图形，可以自由缩放、旋转、编辑
- 插入后，公式不再与插件关联，无法直接编辑公式内容
- 如需修改公式，请在插件中重新输入并插入

### 常见问题

**Q: 插入后公式大小不一致？**

A: 插件使用固定标尺高度方案确保字号一致。如果遇到问题：
- 确认使用相同字号（默认 14pt）
- 查看"调试日志"标签页，确认标尺识别成功
- 如果自动字号统一失败，可以在 Illustrator 中手动调整

**Q: 插入失败，显示"请先打开或创建一个 Illustrator 文档"？**

A: 在使用插入功能前，必须先创建或打开 Illustrator 文档。

**Q: 插入的公式不是矢量图形？**

A: 插件使用三段式导入策略，优先使用矢量方法。如果遇到问题：
- 查看"调试日志"标签页，确认使用的导入方法
- 尝试重新插入
- 如果问题持续，请提交反馈

---

## 调试日志

### 查看调试日志

1. 在插件面板顶部，点击"调试日志"标签页
2. 查看详细的操作日志和错误信息

### 日志类型

- **成功**（绿色）：操作成功完成
- **错误**（红色）：操作失败，显示错误原因
- **警告**（黄色）：操作完成但有警告
- **信息**（蓝色）：一般信息

### 清空日志

点击"清空日志"按钮可以清空当前日志。

---

## 获取帮助

如果遇到问题，请参考：
- **安装指南**: `docs/phase5-installation-guide.md`
- **已知限制**: `docs/phase5-known-limitations.md`
- **反馈方式**: `docs/phase5-feedback-guide.md`

---

**最后更新**: 2026-02-26  
**版本**: 1.0.0-beta
