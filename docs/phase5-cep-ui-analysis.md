# Phase 5 CEP 面板 UI 分析

## 分析日期
2024-02-24

## 当前 CEP 面板 UI 布局概览

### 文件结构
- **CEP 入口**: `extension/client/index.html` (iframe 加载器)
- **主应用**: `math-formula-plugin/dist/index.html` (通过 iframe 加载)
- **主逻辑**: `math-formula-plugin/src/main.ts`
- **样式**: `math-formula-plugin/src/style.css`

### 当前 UI 区域划分

1. **Header 区域** (`.header`)
   - 标题: "Math Formula Plugin"
   - 副标题: 描述文本

2. **输入区** (`.input-section`)
   - LaTeX 输入框 (`#latex-input`)
   - 快速示例按钮组 (5 个示例公式)
   - 输入操作按钮 (渲染、清空)

3. **预览区** (`.preview-section`)
   - SVG 预览容器 (`#preview-output`)
   - 加载指示器 (`#loading-indicator`)
   - 错误消息 (`#error-message`)

4. **选项区**
   - 格式选择器 (`#format-selector`)
   - 字体选择器 (`#font-selector-container`)
   - 字号输入框 (`#font-size-container`, CEP 环境专用)

5. **操作区** (`.actions-section`)
   - 下载 SVG 按钮 (`#download-btn`)
   - 复制 SVG 代码按钮 (`#copy-btn`)
   - 插入到 Illustrator 按钮 (`#insert-btn`, CEP 环境专用)

6. **调试日志区** (`#debug-section`, CEP 环境专用)
   - 调试日志容器 (`#debug-log`)
   - 展开/收起控制

7. **信息区** (`.info-section`)
   - MathJax 版本信息 (`#mathjax-version`)

8. **Footer 区域** (`.footer`)
   - 版权信息

---

## 与用户需求的差距分析

### 用户需求 1: 移除快速示例
**当前状态**: ❌ 存在
- **位置**: 输入区底部
- **代码**: `main.ts` 第 1450-1480 行
- **优先级**: P0 (必须移除)
- **改动范围**: 删除约 30 行代码

### 用户需求 2: 移除下载/复制按钮
**当前状态**: ❌ 存在
- **位置**: 操作区
- **代码**: `main.ts` 第 1400-1430 行 (事件监听), HTML 中的按钮元素
- **优先级**: P0 (必须移除，仅在 CEP 环境中)
- **改动范围**: 添加 CEP 环境检测，隐藏按钮

### 用户需求 3: 调试日志改为标签页
**当前状态**: ❌ 展开区域
- **位置**: 调试日志区
- **代码**: `main.ts` 第 120-130 行 (显示/隐藏逻辑)
- **优先级**: P0 (必须改为标签页)
- **改动范围**: 重构 UI 结构，添加标签页导航

### 用户需求 4: 瑞士国际主义设计风格
**当前状态**: ❌ 不符合
- **当前风格**: 现代扁平风格，但不够简洁
- **问题**:
  - 配色方案不够中性 (主色 `#1976d2` 偏蓝)
  - 间距不够紧凑 (section-gap: 1.5rem)
  - 装饰元素过多 (阴影、圆角)
  - 排版层次不够清晰
- **优先级**: P1 (设计风格调整)
- **改动范围**: 全局 CSS 变量调整

### 用户需求 5: 扩展名称
**当前状态**: ❌ "Math Formula Plugin"
- **位置**: `extension/CSXS/manifest.xml` 第 15 行
- **目标**: "数学公式生成器"
- **优先级**: P0 (必须更新)
- **改动范围**: 修改 1 行配置

### 用户需求 6: 字体包工具入口
**当前状态**: ❌ 不存在
- **位置**: 应在选项区
- **优先级**: P0 (必须添加)
- **改动范围**: 添加按钮 + 事件处理

---

## 问题清单（按优先级排序）

### P0: 必须移除/添加

1. **移除快速示例区域**
   - 文件: `main.ts`
   - 行数: 1450-1480
   - 改动: 删除代码

2. **隐藏下载/复制按钮（CEP 环境专用）**
   - 文件: `main.ts`, `style.css`
   - 改动: 添加 CEP 环境检测，隐藏按钮

3. **更新扩展名称**
   - 文件: `extension/CSXS/manifest.xml`
   - 行数: 15
   - 改动: "Math Formula Plugin" → "数学公式生成器"

4. **调试日志改为标签页**
   - 文件: `index.html`, `main.ts`, `style.css`
   - 改动: 重构 UI 结构，添加标签页导航

5. **添加字体包工具入口按钮**
   - 文件: `index.html`, `main.ts`, `style.css`
   - 改动: 添加按钮 + 事件处理

### P1: 设计风格调整

6. **应用瑞士国际主义设计风格**
   - 文件: `style.css`
   - 改动: 全局 CSS 变量调整
   - 子任务:
     - 配色方案调整 (中性色、高对比度)
     - 间距规范调整 (紧凑、规整)
     - 排版规范调整 (无衬线字体、清晰层次)
     - 移除装饰元素 (阴影、渐变)

7. **应用 Adobe 深色主题**
   - 文件: `style.css`
   - 改动: CSS 变量定义
   - 配色:
     - 背景色: `#2d2d2d`, `#1e1e1e`
     - 文本色: `#f8f8f2`, `#cccccc`
     - 边框色: `#444444`
     - 强调色: `#0d6efd` (Adobe 蓝)

### P2: 优化建议

8. **优化输入区布局**
   - 调整 LaTeX 输入框高度 (建议 100px)
   - 优化占位符文本
   - 优化字体和行高

9. **优化预览区布局**
   - 调整最小高度 (建议 150px)
   - 优化边框和背景色
   - 优化 SVG 居中显示

10. **优化选项区布局**
    - 优化字体选择器样式
    - 优化字号输入框样式
    - 优化字体包工具入口按钮样式

11. **优化操作区布局**
    - 调整按钮顺序 (渲染、插入、清空)
    - 统一按钮样式
    - 区分主次按钮

---

## 设计风格对比

### 当前风格 vs 瑞士国际主义风格

| 维度 | 当前风格 | 瑞士国际主义风格 | 改动建议 |
|------|---------|-----------------|---------|
| **配色** | 主色 `#1976d2` (蓝色) | 中性色、高对比度 | 改为 `#333333` (深灰) |
| **间距** | section-gap: 1.5rem | 紧凑、规整 | 改为 1rem |
| **圆角** | radius-lg: 8px | 2-4px 或无圆角 | 改为 2px |
| **阴影** | shadow-md: 0 2px 4px | 无阴影或极浅阴影 | 移除或改为 0 1px 2px |
| **排版** | 多层次标题 | 清晰层次、最小装饰 | 简化标题样式 |
| **字体** | -apple-system, sans-serif | 无衬线字体 | 保持不变 |

### Adobe 原生面板设计语言

- **配色**: 深色主题 (`#2d2d2d`, `#1e1e1e`)
- **间距**: 紧凑 (8px 基准网格)
- **圆角**: 2-4px
- **阴影**: 无或极浅
- **排版**: 清晰层次、无装饰
- **字体**: 无衬线字体

---

## 改动影响评估

### 核心功能接口
✅ **不受影响** - 所有改动仅涉及 UI 层，不修改核心功能接口:
- `WebFormulaGenerator`
- `FormulaParser`
- `FontPackLoader`
- `IllustratorBridge`

### 回归测试范围
- Lint 检查
- TypeScript 类型检查
- 5 个关键用例:
  1. LaTeX 输入 → 渲染 → 预览
  2. UnicodeMath 粘贴 → 转换 → 渲染
  3. 自定义字体包加载 → 应用 → 渲染
  4. 字号统一功能 → 插入到 Illustrator
  5. 歧义处理 → 人工选择 → 渲染

---

## 下一步行动

### 立即执行 (P0)
1. 移除快速示例区域 (Task 19.3)
2. 隐藏下载/复制按钮 (Task 19.4)
3. 更新扩展名称 (Task 19.5)
4. 实现标签页结构 (Task 19.6)
5. 添加字体包工具入口按钮 (Task 19.7)

### 后续执行 (P1)
6. 应用 Adobe 深色主题 (Task 19.8)
7. 应用瑞士国际主义设计风格 (Task 19.9)

### 优化执行 (P2)
8. 优化各区域布局 (Task 19.10-19.13)
9. 优化调试日志标签页 (Task 19.14)
10. 测试不同面板尺寸 (Task 19.15)

---

## 护栏要求

### 每次 UI 迭代后
1. 运行 Lint 检查: `npm run lint`
2. 运行 Typecheck: `npm run typecheck`
3. 手动测试 5 个关键用例
4. 记录回归测试结果到 `docs/phase5-regression-test-log.md`

### 核心功能接口保持不变
- ✅ 不修改 `WebFormulaGenerator` 接口
- ✅ 不修改 `FormulaParser` 接口
- ✅ 不修改 `FontPackLoader` 接口
- ✅ 不修改 `IllustratorBridge` 接口

---

## 总结

当前 CEP 面板 UI 与用户需求存在 6 个主要差距，其中 5 个为 P0 优先级（必须移除/添加），1 个为 P1 优先级（设计风格调整）。所有改动仅涉及 UI 层，不影响核心功能接口，回归测试风险可控。

建议按照 P0 → P1 → P2 的顺序逐步执行，每次迭代后运行完整的回归测试，确保功能稳定性。
