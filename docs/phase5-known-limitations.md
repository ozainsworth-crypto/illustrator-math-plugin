# Math Formula Plugin - 已知限制（测试版本）

**版本**: 1.0.0-beta  
**更新日期**: 2026-02-26

---

## 兼容性范围

### Illustrator 版本

**已验证版本**：
- ✅ Adobe Illustrator 2026 (v30.x) - macOS 14.1 + Apple Silicon

**待验证版本**（可能兼容，但未完整测试）：
- ⏳ Adobe Illustrator 2024 (v28.x)
- ⏳ Adobe Illustrator 2023 (v27.x)

**不支持版本**：
- ❌ Adobe Illustrator 2022 (v26.x) 及更早版本

### 操作系统

**已验证平台**：
- ✅ macOS 14.1 (Sonoma) + Apple Silicon

**待验证平台**（可能兼容，但未完整测试）：
- ⏳ macOS 13.x (Ventura) + Intel Mac
- ⏳ macOS 12.x (Monterey) + Intel Mac
- ⏳ Windows 11 + x64
- ⏳ Windows 10 + x64

**不支持平台**：
- ❌ macOS 11.x (Big Sur) 及更早版本
- ❌ Windows 8.1 及更早版本
- ❌ Windows on ARM（未测试）

### CEP 版本

- **最低要求**：CEP 6.0
- **推荐版本**：CEP 11.0 或更高
- **已验证**：CEP 6.0-12.0

---

## 功能限制

### 字体包工具

**限制**：
- 字体包构建工具需要手动打开（CEP 不自动启动后端）
- 用户需要通过"字体选项-更多"菜单手动打开字体包工具
- 字体包工具在浏览器中运行（需要 Node.js 环境）

**原因**：
- CEP 环境的 Shell 执行能力有限
- 自动启动后端服务可能导致权限和路径问题
- 手动启动更稳定可靠

**规避方式**：
1. 点击字体选择器旁边的"⋮"（三点）按钮
2. 选择"打开字体包构建工具"
3. 在浏览器中使用字体包工具

### 字体替换范围

**限制**：
- 仅替换字母数字（A-Z, a-z, 0-9）和部分符号
- 不替换希腊字母、大型运算符、伸缩定界符等

**原因**：
- 数学符号需要特殊的 variant 和 assembly 数据
- 替换这些符号可能导致渲染错误或变形

**规避方式**：
- 接受默认行为（字母数字使用自定义字体，符号保持默认）
- 如需完全自定义，可以在 Illustrator 中手动编辑插入的 SVG

### UnicodeMath 支持

**限制**：
- 仅支持 UnicodeMath 的常见子集（约 80% 覆盖率）
- 不支持复杂的嵌套结构和高级语法

**原因**：
- UnicodeMath 规范复杂，完整实现需要大量开发时间
- 当前实现基于 20 条常见样例

**规避方式**：
- 对于不支持的语法，手动转换为 LaTeX
- 或使用 AsciiMath 作为降级兜底

### 插入方法

**限制**：
- 插件使用三段式导入策略（方法 A/B/C）
- 不同 Illustrator 版本可能使用不同的导入方法
- 方法 A（OpenCopyPaste）最稳定，但可能影响剪贴板

**原因**：
- Illustrator API 在不同版本中有差异
- 某些 API（如 `placedItems.add()`）在部分版本中不可用

**规避方式**：
- 插件会自动选择最佳方法
- 如果插入失败，查看"调试日志"标签页了解使用的方法
- 可以尝试手动导出 SVG 并在 Illustrator 中打开

### 字号统一

**限制**：
- 字号统一依赖标尺识别（相对特征匹配）
- 在某些情况下可能识别失败（如公式过于简单或复杂）

**原因**：
- 标尺识别基于相对特征（高度比例、位置关系）
- 不同字体和公式结构可能影响识别准确性

**规避方式**：
- 如果字号不一致，可以在 Illustrator 中手动调整
- 或重新渲染公式（有时重新渲染可以解决问题）

---

## 性能限制

### 公式复杂度

**限制**：
- 过于复杂的公式（如大型矩阵、多层嵌套）可能导致渲染慢或插入慢
- 建议单个公式不超过 100 个元素

**规避方式**：
- 将复杂公式拆分为多个简单公式
- 使用更简洁的 LaTeX 语法

### 字体包大小

**限制**：
- 过大的字体包（如包含大量字形）可能影响加载速度
- 建议字体包大小不超过 5 MB

**规避方式**：
- 仅启用必要的字符集选项
- 使用精简的字体文件

### 临时文件清理

**限制**：
- 插入失败时，临时文件会保留 24 小时用于诊断
- 可能占用少量磁盘空间

**规避方式**：
- 定期清理临时文件目录：
  - macOS: `~/Library/Application Support/MathFormulaPlugin/`
  - Windows: `%APPDATA%\MathFormulaPlugin\`

---

## 已知问题

### 问题 1：面板加载慢

**症状**：
- 首次打开面板时，加载时间较长（5-10 秒）

**原因**：
- MathJax 库较大（约 20 MB）
- CEP webview 需要加载和初始化

**规避方式**：
- 耐心等待加载完成
- 后续打开会更快（浏览器缓存）

### 问题 2：字体包刷新延迟

**症状**：
- 使用字体包工具生成新字体包后，插件显示的字体信息不是最新的

**原因**：
- CEP 环境的 Chromium 浏览器对 manifest.json 进行了激进的 HTTP 缓存
- 即使使用缓存破解参数，仍可能需要 2-4 秒才能检测到更新

**规避方式**：
- 等待 2-4 秒（轮询机制会自动检测更新）
- 或手动点击"刷新字体信息"按钮
- 或完全重启 Illustrator（最彻底的方法）

### 问题 3：标尺识别失败

**症状**：
- 插入的公式字号不一致
- 调试日志显示"标尺识别失败"

**原因**：
- 公式过于简单（如单个字母）或过于复杂
- 标尺特征不明显

**规避方式**：
- 重新渲染公式（有时可以解决）
- 在 Illustrator 中手动调整公式大小
- 使用相同字号输入（默认 14pt）

### 问题 4：插入后剪贴板被占用

**症状**：
- 使用方法 A（OpenCopyPaste）插入后，剪贴板内容被替换

**原因**：
- 方法 A 使用 Open → Copy → Paste 流程
- 会临时占用剪贴板

**规避方式**：
- 接受此行为（方法 A 最稳定）
- 或在插入前保存重要的剪贴板内容

---

## 延期至 Phase 6 的功能

以下功能已延期至 Phase 6（Bugfix & Stabilization）：

### 键盘快捷键

**状态**：延期至 Phase 6

**原因**：
- Phase 5 聚焦于可安装测试版本
- 键盘快捷键属于优化功能，非关键路径

**计划**：
- Phase 6 将实现以下快捷键：
  - Ctrl/Cmd + Enter：渲染公式
  - Ctrl/Cmd + S：下载 SVG
  - Ctrl/Cmd + I：插入到 Illustrator

### CEP Shell 执行能力

**状态**：延期至 Phase 6

**原因**：
- CEP 环境的 Shell 执行能力有限
- 需要系统化排查和稳定实现
- 非 Phase 5 关键路径

**计划**：
- Phase 6 将完成 Task 19.20 系列任务
- 实现 CEP 内自动启动字体包工具后端
- 或提供稳定的降级方案

### 完整的跨平台兼容性测试

**状态**：延期至 Phase 6

**原因**：
- Phase 5 仅验证了 1 个必测组合（macOS 14.1 + AI 2026 + Apple Silicon）
- 其他 4 个必测组合待验证

**计划**：
- Phase 6 将完成所有 5 个必测组合的回归测试
- 记录已知限制和不兼容情况
- 实现降级模式（如需要）

---

## 规避策略总结

### 通用规避策略

1. **遇到问题时**：
   - 查看"调试日志"标签页
   - 尝试重新渲染或重新插入
   - 完全重启 Illustrator

2. **字体包问题**：
   - 手动打开字体包工具
   - 等待 2-4 秒自动刷新
   - 或手动点击"刷新字体信息"

3. **插入问题**：
   - 确认已打开文档
   - 查看调试日志了解使用的导入方法
   - 尝试手动导出 SVG 并在 Illustrator 中打开

4. **性能问题**：
   - 简化公式
   - 使用精简的字体包
   - 定期清理临时文件

### 降级模式

如果遇到无法解决的问题，可以使用以下降级模式：

1. **仅导出模式**：
   - 在 Web 版本中使用插件（不依赖 CEP）
   - 导出 SVG 文件
   - 在 Illustrator 中手动打开 SVG

2. **外部 Web 生成器**：
   - 使用独立的 Web 应用（如 MathJax 官方 demo）
   - 生成 SVG 并手动导入 Illustrator

---

## 获取帮助

如果遇到问题，请参考：
- **安装指南**: `docs/phase5-installation-guide.md`
- **使用指南**: `docs/phase5-usage-guide.md`
- **反馈方式**: `docs/phase5-feedback-guide.md`

---

**最后更新**: 2026-02-26  
**版本**: 1.0.0-beta
