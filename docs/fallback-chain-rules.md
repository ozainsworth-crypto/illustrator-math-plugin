# é™çº§é“¾è§„åˆ™æ–‡æ¡£

**ç‰ˆæœ¬**: 1.0.0  
**æ—¥æœŸ**: 2026-02-02  
**ä½œè€…**: Math Formula Plugin Team

---

## æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰äº†æ•°å­¦å…¬å¼æ’ä»¶çš„å®Œæ•´é™çº§é“¾ï¼ˆFallback Chainï¼‰ï¼Œç¡®ä¿åœ¨å„ç§è¾“å…¥åœºæ™¯ä¸‹éƒ½èƒ½æä¾›æœ€ä½³çš„ç”¨æˆ·ä½“éªŒã€‚é™çº§é“¾æ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡çš„å®¹é”™æœºåˆ¶ï¼Œå½“ä¸»è¦è§£æè·¯å¾„å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å°è¯•å¤‡é€‰æ–¹æ¡ˆï¼Œç›´åˆ°æ‰¾åˆ°å¯è¡Œçš„è§£å†³æ–¹æ¡ˆæˆ–æä¾›æ˜ç¡®çš„ç”¨æˆ·æŒ‡å¯¼ã€‚

---

## é™çº§é“¾æ¶æ„

### å®Œæ•´é™çº§é“¾

```
ç”¨æˆ·è¾“å…¥
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¾“å…¥å½’ä¸€åŒ– (PasteNormalizer)                              â”‚
â”‚    - æ¸…ç†é›¶å®½å­—ç¬¦ã€æ§åˆ¶å­—ç¬¦                                   â”‚
â”‚    - ç»Ÿä¸€ç©ºç™½å­—ç¬¦å’Œæ¢è¡Œç¬¦                                     â”‚
â”‚    - æå–çº¯æ–‡æœ¬å†…å®¹                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ ¼å¼æ£€æµ‹ (FormulaParser.detectFormat)                    â”‚
â”‚    - LaTeX: åŒ…å« \command                                    â”‚
â”‚    - UnicodeMath: åŒ…å« Unicode æ•°å­¦ç¬¦å·æˆ– UnicodeMath æ¨¡å¼   â”‚
â”‚    - AsciiMath: çº¯ ASCII æ•°å­¦è¡¨è¾¾å¼                          â”‚
â”‚    - å¯Œæ–‡æœ¬: åŒ…å« HTML æ ‡ç­¾                                  â”‚
â”‚    - æœªçŸ¥: æ— æ³•è¯†åˆ«çš„æ ¼å¼                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. æ ¼å¼å¤„ç†                                                  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ LaTeX        â”‚  â”‚ UnicodeMath  â”‚  â”‚ AsciiMath    â”‚      â”‚
â”‚  â”‚ (ç›´é€š)       â”‚  â”‚ (è§£æè½¬æ¢)    â”‚  â”‚ (Plurimath)  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â†“                 â†“                  â†“               â”‚
â”‚    æˆåŠŸ/å¤±è´¥         æˆåŠŸ/å¤±è´¥/æ­§ä¹‰      æˆåŠŸ/å¤±è´¥           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. é™çº§å¤„ç†                                                  â”‚
â”‚                                                              â”‚
â”‚  UnicodeMath å¤±è´¥ â†’ AsciiMath å…œåº•                           â”‚
â”‚  AsciiMath å¤±è´¥ â†’ äººå·¥ç¼–è¾‘æç¤º                               â”‚
â”‚  å¯Œæ–‡æœ¬/æœªçŸ¥ â†’ æ ¼å¼è½¬æ¢æŒ‡å¯¼                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. æ­§ä¹‰å¤„ç† (AmbiguityScorer)                               â”‚
â”‚    - ç½®ä¿¡åº¦è¯„åˆ†                                              â”‚
â”‚    - è‡ªåŠ¨é€‰æ‹© vs äººå·¥é€‰æ‹©                                    â”‚
â”‚    - å€™é€‰é¡¹å¯¹æ¯”ç•Œé¢                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆ LaTeX è¾“å‡º â†’ MathJax æ¸²æŸ“ â†’ SVG
```

---

## é™çº§èŠ‚ç‚¹è¯¦ç»†è¯´æ˜

### èŠ‚ç‚¹ 1: è¾“å…¥å½’ä¸€åŒ–

**ç›®çš„**: æ¸…ç†å’Œæ ‡å‡†åŒ–ç”¨æˆ·è¾“å…¥ï¼Œç§»é™¤å¯èƒ½å¹²æ‰°è§£æçš„å­—ç¬¦ã€‚

**å¤„ç†å†…å®¹**:
- é›¶å®½å­—ç¬¦ (Zero-Width Space, Zero-Width Joiner)
- æ§åˆ¶å­—ç¬¦ (é™¤æ¢è¡Œã€åˆ¶è¡¨ç¬¦å¤–)
- BOM (Byte Order Mark)
- ç©ºç™½å­—ç¬¦å½’ä¸€åŒ– (å…¨è§’ç©ºæ ¼ â†’ æ ‡å‡†ç©ºæ ¼)
- æ¢è¡Œç¬¦ç»Ÿä¸€ (\r\n, \r â†’ \n)

**è§¦å‘æ¡ä»¶**: æ‰€æœ‰è¾“å…¥éƒ½ç»è¿‡æ­¤æ­¥éª¤

**å¯è¿½æº¯æ€§**: 
- æ—¥å¿—è®°å½•: æ¸…ç†å‰åçš„å­—ç¬¦æ•°å˜åŒ–
- ä¿ç•™åŸå§‹è¾“å…¥ä¾›è°ƒè¯•

**å¤±è´¥å¤„ç†**: æ­¤æ­¥éª¤ä¸ä¼šå¤±è´¥ï¼Œæœ€åæƒ…å†µè¿”å›åŸå§‹è¾“å…¥

---

### èŠ‚ç‚¹ 2: æ ¼å¼æ£€æµ‹

**ç›®çš„**: è¯†åˆ«è¾“å…¥çš„æ•°å­¦å…¬å¼æ ¼å¼ã€‚

**æ£€æµ‹è§„åˆ™**:

| æ ¼å¼ | æ£€æµ‹ç‰¹å¾ | ä¼˜å…ˆçº§ |
|------|---------|--------|
| å¯Œæ–‡æœ¬ | åŒ…å« HTML æ ‡ç­¾ `<...>` | 1 (æœ€é«˜) |
| LaTeX | åŒ…å«åæ–œæ å‘½ä»¤ `\command` | 2 |
| UnicodeMath | åŒ…å« Unicode æ•°å­¦ç¬¦å· (âˆš, âˆ‘, Î±) æˆ– UnicodeMath æ¨¡å¼ (a/b, x^2, _(...)^n) | 3 |
| AsciiMath | çº¯ ASCII æ•°å­¦è¿ç®—ç¬¦ (+, -, *, /, ^, _) | 4 |
| æœªçŸ¥ | æ— æ³•è¯†åˆ« | 5 (æœ€ä½) |

**è§¦å‘æ¡ä»¶**: è¾“å…¥å½’ä¸€åŒ–å®Œæˆå

**å¯è¿½æº¯æ€§**:
- è¿”å›æ£€æµ‹åˆ°çš„æ ¼å¼ç±»å‹
- è®°å½•åŒ¹é…çš„æ£€æµ‹è§„åˆ™

**å¤±è´¥å¤„ç†**: è¿”å› `UNKNOWN` æ ¼å¼ï¼Œè¿›å…¥é™çº§æç¤ºæµç¨‹

---

### èŠ‚ç‚¹ 3: æ ¼å¼å¤„ç†

#### 3.1 LaTeX ç›´é€š

**ç›®çš„**: LaTeX æ ¼å¼æ— éœ€è½¬æ¢ï¼Œç›´æ¥ä¼ é€’ç»™ MathJaxã€‚

**å¤„ç†é€»è¾‘**:
```typescript
if (format === FormulaFormat.LATEX) {
  return {
    latex: input,
    success: true,
    confidence: 1.0
  };
}
```

**è§¦å‘æ¡ä»¶**: æ£€æµ‹åˆ° LaTeX æ ¼å¼

**å¯è¿½æº¯æ€§**:
- è®°å½•åŸå§‹ LaTeX è¾“å…¥
- ç½®ä¿¡åº¦å›ºå®šä¸º 1.0

**å¤±è´¥å¤„ç†**: LaTeX ç›´é€šä¸ä¼šå¤±è´¥ï¼Œä½† MathJax æ¸²æŸ“æ—¶å¯èƒ½æŠ¥é”™

---

#### 3.2 UnicodeMath è§£æè½¬æ¢

**ç›®çš„**: å°† UnicodeMath çº¿æ€§æ ¼å¼è½¬æ¢ä¸º LaTeXã€‚

**å¤„ç†é€»è¾‘**:
```typescript
if (format === FormulaFormat.UNICODEMATH) {
  const result = unicodemathParser.parse(input);
  
  if (result.success) {
    return {
      latex: result.latex,
      success: true,
      ambiguous: result.ambiguous,
      confidence: result.ambiguous ? 0.6 : 0.9
    };
  }
  
  // å¤±è´¥ â†’ å°è¯• AsciiMath é™çº§
  return tryAsciiMathFallback(input);
}
```

**è§¦å‘æ¡ä»¶**: æ£€æµ‹åˆ° UnicodeMath æ ¼å¼

**å¯è¿½æº¯æ€§**:
- è®°å½•è§£æçš„ UnicodeMath è¾“å…¥
- è®°å½•è½¬æ¢åçš„ LaTeX
- è®°å½•æ˜¯å¦å­˜åœ¨æ­§ä¹‰
- è®°å½•ç½®ä¿¡åº¦è¯„åˆ†

**å¤±è´¥å¤„ç†**: è‡ªåŠ¨è¿›å…¥ AsciiMath é™çº§å…œåº•

**æ­§ä¹‰å¤„ç†**: 
- æ£€æµ‹æ­§ä¹‰ (å¦‚ `x^2^3`)
- ç”Ÿæˆå¤šä¸ªå€™é€‰é¡¹
- ä½¿ç”¨ AmbiguityScorer è¯„åˆ†
- è‡ªåŠ¨é€‰æ‹©æˆ–å¼¹å‡ºäººå·¥é€‰æ‹©ç•Œé¢

---

#### 3.3 AsciiMath è½¬æ¢ (Plurimath)

**ç›®çš„**: ä½¿ç”¨ Plurimath åº“å°† AsciiMath è½¬æ¢ä¸º LaTeXã€‚

**å¤„ç†é€»è¾‘**:
```typescript
if (format === FormulaFormat.ASCIIMATH) {
  const Plurimath = await loadPlurimath();
  
  if (!Plurimath) {
    return {
      success: false,
      error: 'Plurimath åº“åŠ è½½å¤±è´¥',
      fallback: true,
      fallbackType: 'manual'
    };
  }
  
  try {
    const formula = new Plurimath(input, 'asciimath');
    const latex = formula.toLatex();
    
    return {
      latex,
      success: true,
      confidence: 0.8
    };
  } catch (e) {
    return {
      success: false,
      error: `AsciiMath è½¬æ¢å¤±è´¥: ${e.message}`,
      fallback: true,
      fallbackType: 'manual'
    };
  }
}
```

**è§¦å‘æ¡ä»¶**: 
- æ£€æµ‹åˆ° AsciiMath æ ¼å¼
- æˆ– UnicodeMath è§£æå¤±è´¥åçš„é™çº§

**å¯è¿½æº¯æ€§**:
- è®°å½• AsciiMath è¾“å…¥
- è®°å½•è½¬æ¢åçš„ LaTeX
- è®°å½•æ˜¯å¦ä¸ºé™çº§æ¨¡å¼ (`fallback: true`)
- è®°å½• Plurimath åŠ è½½çŠ¶æ€

**å¤±è´¥å¤„ç†**: è¿”å›äººå·¥ç¼–è¾‘æç¤º

---

### èŠ‚ç‚¹ 4: é™çº§å¤„ç†

#### 4.1 UnicodeMath â†’ AsciiMath é™çº§

**è§¦å‘æ¡ä»¶**: UnicodeMath è§£æå¤±è´¥

**é™çº§é€»è¾‘**:
```typescript
private async tryAsciiMathFallback(input: string): Promise<ParseResult> {
  const asciiMathResult = await this.handleAsciiMath(input);
  
  if (asciiMathResult.success) {
    return {
      ...asciiMathResult,
      fallback: true,
      fallbackType: 'asciimath',
      confidence: 0.6  // é™çº§æ¨¡å¼ç½®ä¿¡åº¦è¾ƒä½
    };
  }
  
  return {
    success: false,
    error: 'UnicodeMath è§£æå¤±è´¥ï¼Œä¸” AsciiMath é™çº§ä¹Ÿå¤±è´¥ã€‚è¯·æ£€æŸ¥è¾“å…¥æ ¼å¼æˆ–æ‰‹åŠ¨ç¼–è¾‘ä¸º LaTeXã€‚'
  };
}
```

**å¯è¿½æº¯æ€§**:
- æ ‡è®° `fallback: true`
- æ ‡è®° `fallbackType: 'asciimath'`
- é™ä½ç½®ä¿¡åº¦è‡³ 0.6

**UI æç¤º**: 
- æ˜¾ç¤º"ä½¿ç”¨ AsciiMath é™çº§æ¨¡å¼"
- æä¾›åˆ‡æ¢åˆ°æ‰‹åŠ¨ç¼–è¾‘çš„é€‰é¡¹

---

#### 4.2 å¯Œæ–‡æœ¬é™çº§æç¤º

**è§¦å‘æ¡ä»¶**: æ£€æµ‹åˆ°å¯Œæ–‡æœ¬/HTML æ ¼å¼

**æç¤ºå†…å®¹**:
```
æ£€æµ‹åˆ°å¯Œæ–‡æœ¬æ ¼å¼ï¼Œæ— æ³•è§£æã€‚

å»ºè®®æ“ä½œï¼š
1. åœ¨ PowerPoint/Word ä¸­é€‰ä¸­å…¬å¼
2. å³é”®é€‰æ‹©"çº¿æ€§æ ¼å¼"
3. é‡æ–°å¤åˆ¶çº¯æ–‡æœ¬å†…å®¹

æˆ–è€…ï¼š
- æ‰‹åŠ¨è¾“å…¥ LaTeX æ ¼å¼
- åˆ‡æ¢åˆ° AsciiMath æ ¼å¼
```

**å¯è¿½æº¯æ€§**:
- ä¿ç•™åŸå§‹å¯Œæ–‡æœ¬å†…å®¹
- è®°å½•æ£€æµ‹åˆ°çš„ HTML æ ‡ç­¾

**UI æç¤º**: æ˜¾ç¤ºå¯æ“ä½œçš„é”™è¯¯æç¤ºç•Œé¢

---

#### 4.3 æœªçŸ¥æ ¼å¼é™çº§æç¤º

**è§¦å‘æ¡ä»¶**: æ— æ³•è¯†åˆ«è¾“å…¥æ ¼å¼

**æç¤ºå†…å®¹**:
```
æ— æ³•è¯†åˆ«çš„æ ¼å¼ã€‚

æ”¯æŒçš„æ ¼å¼ï¼š
- LaTeX: \frac{a}{b}, \sqrt{x}
- UnicodeMath: a/b, âˆšx, âˆ‘_(i=1)^n
- AsciiMath: (a+b)/c, sqrt(x)

å»ºè®®æ“ä½œï¼š
- æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºæ•°å­¦å…¬å¼
- å°è¯•ä½¿ç”¨ LaTeX æ ¼å¼
- æŸ¥çœ‹æ”¯æŒçš„ UnicodeMath å­é›†æ–‡æ¡£
```

**å¯è¿½æº¯æ€§**:
- ä¿ç•™åŸå§‹è¾“å…¥
- è®°å½•æ ¼å¼æ£€æµ‹å¤±è´¥åŸå› 

**UI æç¤º**: æ˜¾ç¤ºæ ¼å¼å¸®åŠ©å’Œç¤ºä¾‹

---

### èŠ‚ç‚¹ 5: æ­§ä¹‰å¤„ç†

**ç›®çš„**: å¤„ç†å­˜åœ¨å¤šç§è§£é‡Šçš„è¾“å…¥ã€‚

**å¤„ç†æµç¨‹**:

```
æ£€æµ‹åˆ°æ­§ä¹‰
    â†“
ç”Ÿæˆå€™é€‰é¡¹ (2+ ä¸ª)
    â†“
AmbiguityScorer è¯„åˆ†
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç½®ä¿¡åº¦å·®å¼‚ >= é˜ˆå€¼ (0.3)            â”‚
â”‚ ä¸” æœ€é«˜ç½®ä¿¡åº¦ >= æœ€ä½é˜ˆå€¼ (0.6)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
  æ˜¯ â†“ å¦
    â†“
è‡ªåŠ¨é€‰æ‹© â† â†’ äººå·¥é€‰æ‹©ç•Œé¢
    â†“           â†“
 æœ€é«˜ç½®ä¿¡åº¦   æ˜¾ç¤ºå€™é€‰é¡¹å¯¹æ¯”
  å€™é€‰é¡¹      ç”¨æˆ·é€‰æ‹©
```

**è‡ªåŠ¨é€‰æ‹©è§„åˆ™**:
- ç½®ä¿¡åº¦å·®å¼‚ >= 0.3 (å¯é…ç½®)
- æœ€é«˜ç½®ä¿¡åº¦ >= 0.6 (å¯é…ç½®)
- å¯ç”¨è‡ªåŠ¨é€‰æ‹© (å¯é…ç½®)

**äººå·¥é€‰æ‹©ç•Œé¢**:
- æ˜¾ç¤ºåŸå§‹è¾“å…¥
- å¹¶æ’æ˜¾ç¤ºå€™é€‰é¡¹çš„ SVG é¢„è§ˆ
- æ˜¾ç¤ºå¯¹åº”çš„ LaTeX ä»£ç 
- å…è®¸æ‰‹åŠ¨ç¼–è¾‘ LaTeX

**å¯è¿½æº¯æ€§**:
- è®°å½•æ­§ä¹‰ç±»å‹
- è®°å½•æ‰€æœ‰å€™é€‰é¡¹åŠå…¶ç½®ä¿¡åº¦
- è®°å½•è‡ªåŠ¨é€‰æ‹©æˆ–äººå·¥é€‰æ‹©çš„ç»“æœ

---

## é™çº§å†³ç­–æµç¨‹å›¾

```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[è¾“å…¥å½’ä¸€åŒ–]
    B --> C[æ ¼å¼æ£€æµ‹]
    
    C --> D{æ ¼å¼ç±»å‹}
    
    D -->|LaTeX| E[LaTeX ç›´é€š]
    D -->|UnicodeMath| F[UnicodeMath è§£æ]
    D -->|AsciiMath| G[AsciiMath è½¬æ¢]
    D -->|å¯Œæ–‡æœ¬| H[å¯Œæ–‡æœ¬é™çº§æç¤º]
    D -->|æœªçŸ¥| I[æœªçŸ¥æ ¼å¼é™çº§æç¤º]
    
    E --> J{æˆåŠŸ?}
    F --> K{æˆåŠŸ?}
    G --> L{æˆåŠŸ?}
    
    J -->|æ˜¯| M[è¾“å‡º LaTeX]
    J -->|å¦| N[MathJax é”™è¯¯]
    
    K -->|æ˜¯| O{æ­§ä¹‰?}
    K -->|å¦| P[AsciiMath é™çº§]
    
    O -->|æ˜¯| Q[æ­§ä¹‰å¤„ç†]
    O -->|å¦| M
    
    P --> L
    
    L -->|æ˜¯| R[æ ‡è®°é™çº§æ¨¡å¼]
    L -->|å¦| S[äººå·¥ç¼–è¾‘æç¤º]
    
    Q --> T{è‡ªåŠ¨é€‰æ‹©?}
    T -->|æ˜¯| M
    T -->|å¦| U[äººå·¥é€‰æ‹©ç•Œé¢]
    
    R --> M
    U --> M
    
    H --> V[æ ¼å¼è½¬æ¢æŒ‡å¯¼]
    I --> W[æ ¼å¼å¸®åŠ©]
    
    M --> X[MathJax æ¸²æŸ“]
    X --> Y[SVG è¾“å‡º]
```

---

## é™çº§æ¨¡å¼çš„ UI æç¤ºè§„èŒƒ

### 1. é™çº§æ¨¡å¼æ ‡è¯†

å½“ä½¿ç”¨é™çº§æ¨¡å¼æ—¶ï¼ŒUI åº”æ˜ç¡®æ ‡è¯†ï¼š

```
âš ï¸ ä½¿ç”¨ AsciiMath é™çº§æ¨¡å¼

åŸå§‹è¾“å…¥æ— æ³•ä½œä¸º UnicodeMath è§£æï¼Œå·²å°è¯• AsciiMath è½¬æ¢ã€‚
å¦‚æœç»“æœä¸æ­£ç¡®ï¼Œè¯·æ‰‹åŠ¨ç¼–è¾‘ LaTeX æˆ–è°ƒæ•´è¾“å…¥æ ¼å¼ã€‚
```

### 2. å¯Œæ–‡æœ¬é™çº§æç¤º

```
âŒ æ— æ³•è§£æå¯Œæ–‡æœ¬æ ¼å¼

æ£€æµ‹åˆ° HTML æ ‡ç­¾ï¼Œæ— æ³•ç›´æ¥è§£æã€‚

ğŸ“‹ å¦‚ä½•è·å–çº¯æ–‡æœ¬æ ¼å¼ï¼š
1. åœ¨ PowerPoint/Word ä¸­é€‰ä¸­å…¬å¼
2. å³é”®é€‰æ‹©"çº¿æ€§æ ¼å¼"
3. é‡æ–°å¤åˆ¶çº¯æ–‡æœ¬å†…å®¹

æˆ–è€…ï¼š
â€¢ æ‰‹åŠ¨è¾“å…¥ LaTeX æ ¼å¼
â€¢ åˆ‡æ¢åˆ° AsciiMath æ ¼å¼
```

### 3. æœªçŸ¥æ ¼å¼é™çº§æç¤º

```
â“ æ— æ³•è¯†åˆ«çš„æ ¼å¼

è¾“å…¥å†…å®¹ä¸ç¬¦åˆå·²çŸ¥çš„æ•°å­¦å…¬å¼æ ¼å¼ã€‚

âœ… æ”¯æŒçš„æ ¼å¼ï¼š
â€¢ LaTeX: \frac{a}{b}, \sqrt{x}, \sum_{i=1}^{n}
â€¢ UnicodeMath: a/b, âˆšx, âˆ‘_(i=1)^n
â€¢ AsciiMath: (a+b)/c, sqrt(x), sum_(i=1)^n

ğŸ’¡ å»ºè®®ï¼š
â€¢ æŸ¥çœ‹ UnicodeMath æ”¯æŒå­é›†æ–‡æ¡£
â€¢ å°è¯•ä½¿ç”¨ LaTeX æ ¼å¼
â€¢ æ£€æŸ¥è¾“å…¥æ˜¯å¦åŒ…å«ç‰¹æ®Šå­—ç¬¦
```

### 4. æ­§ä¹‰é€‰æ‹©ç•Œé¢

```
ğŸ”€ æ£€æµ‹åˆ°æ­§ä¹‰

è¾“å…¥ "x^2^3" å­˜åœ¨å¤šç§è§£é‡Šï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰é¡¹ 1: x^{2^{3}} (æ¨è)            â”‚
â”‚ [SVG é¢„è§ˆ]                          â”‚
â”‚ ç½®ä¿¡åº¦: 90%                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€‰é¡¹ 2: (x^{2})^{3}                 â”‚
â”‚ [SVG é¢„è§ˆ]                          â”‚
â”‚ ç½®ä¿¡åº¦: 60%                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[æ‰‹åŠ¨ç¼–è¾‘ LaTeX]
```

---

## å¯è¿½æº¯æ€§è¦æ±‚

### æ—¥å¿—è®°å½•

æ¯ä¸ªé™çº§èŠ‚ç‚¹éƒ½åº”è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š

```typescript
interface FallbackLog {
  timestamp: number;
  nodeType: 'normalize' | 'detect' | 'parse' | 'fallback' | 'ambiguity';
  input: string;
  output?: string;
  success: boolean;
  fallback?: boolean;
  fallbackType?: 'asciimath' | 'manual';
  confidence?: number;
  error?: string;
  metadata?: Record<string, any>;
}
```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è°ƒè¯•æ¨¡å¼æ—¶ï¼Œæ˜¾ç¤ºå®Œæ•´çš„é™çº§é“¾è·¯å¾„ï¼š

```
[DEBUG] Fallback Chain Trace:
1. Input Normalization: âœ“ (removed 3 zero-width chars)
2. Format Detection: UnicodeMath (confidence: 0.95)
3. UnicodeMath Parsing: âœ— (unsupported syntax)
4. AsciiMath Fallback: âœ“ (confidence: 0.6)
5. Final Output: \frac{a+b}{c}
```

---

## æ€§èƒ½è€ƒè™‘

### é™çº§é“¾æ€§èƒ½ç›®æ ‡

| èŠ‚ç‚¹ | ç›®æ ‡è€—æ—¶ | æœ€å¤§è€—æ—¶ |
|------|---------|---------|
| è¾“å…¥å½’ä¸€åŒ– | < 5ms | < 10ms |
| æ ¼å¼æ£€æµ‹ | < 1ms | < 5ms |
| LaTeX ç›´é€š | < 1ms | < 1ms |
| UnicodeMath è§£æ | < 50ms | < 100ms |
| AsciiMath è½¬æ¢ | < 10ms | < 50ms |
| æ­§ä¹‰è¯„åˆ† | < 5ms | < 10ms |
| **æ€»è®¡** | **< 70ms** | **< 180ms** |

### æ€§èƒ½ä¿æŠ¤æªæ–½

1. **è¾“å…¥é•¿åº¦é™åˆ¶**: æœ€å¤§ 10,000 å­—ç¬¦
2. **è§£æè¶…æ—¶**: 5 ç§’è¶…æ—¶
3. **é™çº§æ¬¡æ•°é™åˆ¶**: æœ€å¤š 2 æ¬¡é™çº§

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| 1.0.0 | 2026-02-02 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰å®Œæ•´é™çº§é“¾ |

---

## å‚è€ƒæ–‡æ¡£

- [UnicodeMath æ”¯æŒå­é›†æ–‡æ¡£](./unicodemath-supported-subset.md)
- [æ­§ä¹‰æ¡†æ¶æŒ‡å—](./ambiguity-framework-guide.md)
- [æ­§ä¹‰é›†æˆæŒ‡å—](./ambiguity-integration-guide.md)
- [éœ€æ±‚æ–‡æ¡£ - éœ€æ±‚ 2 (B4.9-10)](../.kiro/specs/math-formula-plugin/requirements.md)
- [è®¾è®¡æ–‡æ¡£ - é™çº§å¤„ç†](../.kiro/specs/math-formula-plugin/design.md)
